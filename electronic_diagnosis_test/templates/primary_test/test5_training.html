
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

{% load static %}
{% block content %}

<script src="https://unpkg.com/htmx.org@1.9.4"></script>

<div class="container mt-5" dir="rtl">
        <div class="text-center">
        <h2 class="text-lg-purple fs-2 mb-5" style="color: #5E2B8C;">الاختبار الفرعي الخامس</h2>
        <h4 class=" mb-5 fs-3" style="color: #fd7e14;">الإملاء الصحيح - الفقرات التدريبية</h4>
    </div>

  <audio id="inst1" class="test5-intro" src="{% static 'audio/primary/test5/Instructions01.mp3' %}" preload="auto"></audio>
  <audio id="inst2" class="test5-intro" src="{% static 'audio/primary/test5/Instructions02.mp3' %}" preload="auto"></audio>
  <audio id="inst3" class="test5-intro" src="{% static 'audio/primary/test5/Instructions03.mp3' %}" preload="auto"></audio>

  {% if error %}
  <div class="alert alert-danger text-center fw-bold" role="alert" >
      {{ error }}
  </div>
    {% else %}


    {% include 'primary_test/test5_training_question.html' %}

  {% endif %}
</div>

<script>
  (function () {
    if (window.test5IntroPlayed) return;
    window.test5IntroPlayed = true;

    const a1 = document.getElementById('inst1');
    const a2 = document.getElementById('inst2');
    const a3 = document.getElementById('inst3');
    if (!a1 || !a2 || !a3) return;

    window.test5IntroDone = false;

    function safePlay(a) {
      return a.play().catch(() => {
        const resume = () => {
          a.play().finally(() => {
            console.log('playing instructions ');
            console.log(a);
            document.removeEventListener('click', resume, true);
            document.removeEventListener('keydown', resume, true);
            document.removeEventListener('touchstart', resume, true);
          });
        };
        document.addEventListener('click', resume, true);
        document.addEventListener('keydown', resume, true);
        document.addEventListener('touchstart', resume, true);
      });
    }

    safePlay(a1);
    a1.addEventListener('ended', () => {
      setTimeout(() => safePlay(a2), 1000);
    }, { once: true });

    a2.addEventListener('ended', () => {
      setTimeout(() => safePlay(a3), 1000);
    }, { once: true });
        a3.addEventListener('ended', () => {
      window.test5IntroDone = true;
      document.dispatchEvent(new Event('test5-intro-done'));
    }, { once: true });

  })();
</script>

{% endblock %}
